{"version":3,"sources":["../src/GLViewNative.js"],"names":["React","Component","PropTypes","View","GLView","EXGLView","propTypes","onContextCreate","func","isRequired","style","any","GLViewNative","onRef","ref","gl","getExtension","name","call","props","capture","opt","Promise","reject","Error","takeSnapshotAsync","afterDraw","flush","endFrameEXP","render","children","rest","__DEV__","console","warn","position","overflow","flex","top","left","opacity"],"mappings":";;;;AACA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,IAAT,QAAqB,cAArB;AACA,SAASC,UAAUC,QAAnB,QAAmC,MAAnC;;AAEA,MAAMC,YAAY;AAChBC,mBAAiBL,UAAUM,IAAV,CAAeC,UADhB;AAEhBC,SAAOR,UAAUS;AAFD,CAAlB;;AAKA,eAAe,MAAMC,YAAN,SAA2BX,SAA3B,CAIZ;AAAA;AAAA;;AAAA,wCAUDY,KAVC,GAUQC,GAAD,IAAoB;AAC1B,WAAKA,GAAL,GAAWA,GAAX;AACD,KAZA,OAcDP,eAdC,GAckBQ,EAAD,IAA+B;AAC/C,YAAM,EAAEC,YAAF,KAAmBD,EAAzB;AACA;AACA;AACAA,SAAGC,YAAH,GAAkBC,QAAQ;AACxB,YAAIA,SAAS,WAAb,EAA0B,OAAO,KAAKH,GAAZ;AAC1B,eAAOE,aAAaE,IAAb,CAAkBH,EAAlB,EAAsBE,IAAtB,CAAP;AACD,OAHD;AAIA,WAAKE,KAAL,CAAWZ,eAAX,CAA2BQ,EAA3B;AACD,KAvBA,OAyBDK,OAzBC,GA0BCC,GADQ,IAOJ;AACJ,YAAM,EAAEP,GAAF,KAAU,IAAhB;AACA,UAAI,CAACA,GAAL,EAAU,OAAOQ,QAAQC,MAAR,CAAe,IAAIC,KAAJ,CAAU,qBAAV,CAAf,CAAP;AACV,aAAOV,IAAIW,iBAAJ,CAAsBJ,GAAtB,CAAP;AACD,KApCA;AAAA;;AAGDK,YAAUX,EAAV,EAAqC;AACnCA,OAAGY,KAAH;AACA;AACAZ,OAAGa,WAAH;AACD;;AA+BDC,WAAS;AACP,mBAAsD,KAAKV,KAA3D;AAAA,UAAM,EAAET,KAAF,EAASH,eAAT,EAA0BuB,QAA1B,EAAN;AAAA,UAA6CC,IAA7C;AACA,QAAIC,OAAJ,EAAa;AACX,UAAI,WAAWD,IAAX,IAAmB,YAAYA,IAAnC,EAAyC;AACvCE,gBAAQC,IAAR,CACE,4GADF;AAGD;AACF;AACD,WACE;AAAC,UAAD;AAAA,mBACMH,IADN;AAEE,eAAO,CAAC,EAAEI,UAAU,UAAZ,EAAwBC,UAAU,QAAlC,EAAD,EAA+C1B,KAA/C;AAFT;AAIE,0BAAC,QAAD;AACE,eAAO,CACLA,KADK,EAEL;AACE2B,gBAAM,CADR;AAEEF,oBAAU,UAFZ;AAGEG,eAAK,CAHP;AAIEC,gBAAM;AAJR,SAFK,CADT;AAUE,yBAAiB,KAAKhC,eAVxB;AAWE,aAAK,KAAKM;AAXZ,QAJF;AAiBE;AAAC,YAAD;AAAA,UAAM,OAAO,EAAE2B,SAAS,CAAX,EAAb;AAA8BV;AAA9B;AAjBF,KADF;AAqBD;AApEA;AAJkBlB,Y,CAKZN,S,GAAYA,S","file":"GLViewNative.js","sourcesContent":["//@flow\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { View } from \"react-native\";\nimport { GLView as EXGLView } from \"expo\";\n\nconst propTypes = {\n  onContextCreate: PropTypes.func.isRequired,\n  style: PropTypes.any\n};\n\nexport default class GLViewNative extends Component<{\n  onContextCreate: (gl: WebGLRenderingContext) => void,\n  style?: any,\n  children?: any\n}> {\n  static propTypes = propTypes;\n\n  afterDraw(gl: WebGLRenderingContext) {\n    gl.flush();\n    // $FlowFixMe\n    gl.endFrameEXP();\n  }\n\n  ref: ?EXGLView;\n  onRef = (ref: ?EXGLView) => {\n    this.ref = ref;\n  };\n\n  onContextCreate = (gl: WebGLRenderingContext) => {\n    const { getExtension } = gl;\n    // monkey patch to get a way to access the EXGLView\n    // $FlowFixMe\n    gl.getExtension = name => {\n      if (name === \"GLViewRef\") return this.ref;\n      return getExtension.call(gl, name);\n    };\n    this.props.onContextCreate(gl);\n  };\n\n  capture = (\n    opt: *\n  ): Promise<{\n    uri: string,\n    localUri: string,\n    width: number,\n    height: number\n  }> => {\n    const { ref } = this;\n    if (!ref) return Promise.reject(new Error(\"glView is unmounted\"));\n    return ref.takeSnapshotAsync(opt);\n  };\n\n  render() {\n    const { style, onContextCreate, children, ...rest } = this.props;\n    if (__DEV__) {\n      if (\"width\" in rest || \"height\" in rest) {\n        console.warn(\n          \"gl-react-expo <Surface>: no such width/height prop. instead you must use the style prop like for a <View>.\"\n        );\n      }\n    }\n    return (\n      <View\n        {...rest}\n        style={[{ position: \"relative\", overflow: \"hidden\" }, style]}\n      >\n        <EXGLView\n          style={[\n            style,\n            {\n              flex: 1,\n              position: \"absolute\",\n              top: 0,\n              left: 0\n            }\n          ]}\n          onContextCreate={this.onContextCreate}\n          ref={this.onRef}\n        />\n        <View style={{ opacity: 0 }}>{children}</View>\n      </View>\n    );\n  }\n}\n"]}